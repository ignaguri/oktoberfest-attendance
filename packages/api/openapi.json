{
  "openapi": "3.1.0",
  "info": {
    "title": "ProstCounter API",
    "version": "0.1.0",
    "description": "API for ProstCounter - Oktoberfest attendance tracking"
  },
  "servers": [
    {
      "url": "http://localhost:3008/api",
      "description": "Local development"
    },
    {
      "url": "https://prostcounter.vercel.app/api",
      "description": "Production"
    }
  ],
  "components": {
    "schemas": {},
    "parameters": {}
  },
  "paths": {
    "/v1/consumption": {
      "post": {
        "tags": [
          "consumption"
        ],
        "summary": "Log a new beer or drink consumption",
        "description": "Records a consumption and updates the attendance record with computed totals",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "festivalId": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "date": {
                    "type": "string",
                    "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                  },
                  "tentId": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "drinkType": {
                    "type": "string",
                    "enum": [
                      "beer",
                      "radler",
                      "alcohol_free",
                      "wine",
                      "soft_drink",
                      "other"
                    ],
                    "default": "beer"
                  },
                  "drinkName": {
                    "type": "string",
                    "maxLength": 255
                  },
                  "basePriceCents": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "pricePaidCents": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "volumeMl": {
                    "type": "integer",
                    "minimum": 1,
                    "default": 1000
                  },
                  "recordedAt": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "idempotencyKey": {
                    "type": "string",
                    "maxLength": 255
                  }
                },
                "required": [
                  "festivalId",
                  "date",
                  "pricePaidCents"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Consumption logged successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "userId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "festivalId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "date": {
                      "type": "string",
                      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "drinkCount": {
                      "type": "integer"
                    },
                    "beerCount": {
                      "type": "integer"
                    },
                    "totalSpentCents": {
                      "type": "integer"
                    },
                    "totalTipCents": {
                      "type": "integer"
                    },
                    "avgPriceCents": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "id",
                    "userId",
                    "festivalId",
                    "date",
                    "createdAt",
                    "updatedAt",
                    "drinkCount",
                    "beerCount",
                    "totalSpentCents",
                    "totalTipCents",
                    "avgPriceCents"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/attendance": {
      "get": {
        "tags": [
          "attendance"
        ],
        "summary": "List user's attendance records",
        "description": "Returns paginated list of attendance records with computed totals",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "festivalId",
            "in": "query"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 50
            },
            "required": false,
            "name": "limit",
            "in": "query"
          },
          {
            "schema": {
              "type": "integer",
              "nullable": true,
              "minimum": 0,
              "default": 0
            },
            "required": false,
            "name": "offset",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Attendances retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "userId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "festivalId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "date": {
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "updatedAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "drinkCount": {
                            "type": "integer"
                          },
                          "beerCount": {
                            "type": "integer"
                          },
                          "totalSpentCents": {
                            "type": "integer"
                          },
                          "totalTipCents": {
                            "type": "integer"
                          },
                          "avgPriceCents": {
                            "type": "integer"
                          }
                        },
                        "required": [
                          "id",
                          "userId",
                          "festivalId",
                          "date",
                          "createdAt",
                          "updatedAt",
                          "drinkCount",
                          "beerCount",
                          "totalSpentCents",
                          "totalTipCents",
                          "avgPriceCents"
                        ]
                      }
                    },
                    "total": {
                      "type": "integer"
                    },
                    "limit": {
                      "type": "integer"
                    },
                    "offset": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "data",
                    "total",
                    "limit",
                    "offset"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/attendance/{id}": {
      "delete": {
        "tags": [
          "attendance"
        ],
        "summary": "Delete an attendance record",
        "description": "Deletes an attendance and all its associated consumptions (cascading delete)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Attendance deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Attendance not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/festivals": {
      "get": {
        "tags": [
          "festivals"
        ],
        "summary": "List all festivals",
        "description": "Returns list of festivals with optional filtering by status or active state",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "enum": [
                "upcoming",
                "active",
                "ended"
              ]
            },
            "required": false,
            "name": "status",
            "in": "query"
          },
          {
            "schema": {
              "type": "boolean",
              "nullable": true
            },
            "required": false,
            "name": "isActive",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Festivals retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "name": {
                            "type": "string"
                          },
                          "startDate": {
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                          },
                          "endDate": {
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                          },
                          "beerCost": {
                            "type": "integer",
                            "nullable": true
                          },
                          "location": {
                            "type": "string",
                            "nullable": true
                          },
                          "mapUrl": {
                            "type": "string",
                            "nullable": true,
                            "format": "uri"
                          },
                          "isActive": {
                            "type": "boolean"
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "upcoming",
                              "active",
                              "ended"
                            ]
                          },
                          "timezone": {
                            "type": "string",
                            "nullable": true
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "updatedAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "startDate",
                          "endDate",
                          "beerCost",
                          "location",
                          "mapUrl",
                          "isActive",
                          "status",
                          "timezone",
                          "createdAt",
                          "updatedAt"
                        ]
                      }
                    }
                  },
                  "required": [
                    "data"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/festivals/{id}": {
      "get": {
        "tags": [
          "festivals"
        ],
        "summary": "Get festival by ID",
        "description": "Returns a single festival by its ID",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Festival retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "name": {
                      "type": "string"
                    },
                    "startDate": {
                      "type": "string",
                      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                    },
                    "endDate": {
                      "type": "string",
                      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                    },
                    "beerCost": {
                      "type": "integer",
                      "nullable": true
                    },
                    "location": {
                      "type": "string",
                      "nullable": true
                    },
                    "mapUrl": {
                      "type": "string",
                      "nullable": true,
                      "format": "uri"
                    },
                    "isActive": {
                      "type": "boolean"
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "upcoming",
                        "active",
                        "ended"
                      ]
                    },
                    "timezone": {
                      "type": "string",
                      "nullable": true
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  },
                  "required": [
                    "id",
                    "name",
                    "startDate",
                    "endDate",
                    "beerCost",
                    "location",
                    "mapUrl",
                    "isActive",
                    "status",
                    "timezone",
                    "createdAt",
                    "updatedAt"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Festival not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/tents": {
      "get": {
        "tags": [
          "tents"
        ],
        "summary": "List tents for a festival",
        "description": "Returns list of tents with festival-specific pricing and availability",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "required": true,
            "name": "festivalId",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Tents retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "festivalId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "tentId": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "beerPrice": {
                            "type": "integer",
                            "nullable": true
                          },
                          "isOpen": {
                            "type": "boolean"
                          },
                          "tent": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "format": "uuid"
                              },
                              "name": {
                                "type": "string"
                              },
                              "description": {
                                "type": "string",
                                "nullable": true
                              },
                              "capacity": {
                                "type": "integer",
                                "nullable": true
                              },
                              "website": {
                                "type": "string",
                                "nullable": true,
                                "format": "uri"
                              },
                              "createdAt": {
                                "type": "string",
                                "format": "date-time"
                              },
                              "updatedAt": {
                                "type": "string",
                                "format": "date-time"
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "description",
                              "capacity",
                              "website",
                              "createdAt",
                              "updatedAt"
                            ]
                          }
                        },
                        "required": [
                          "festivalId",
                          "tentId",
                          "beerPrice",
                          "isOpen",
                          "tent"
                        ]
                      }
                    }
                  },
                  "required": [
                    "data"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    }
  }
}